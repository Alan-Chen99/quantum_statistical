import random

import numpy as np
from scipy.stats import chi2, chi2_contingency, permutation_test

from lib.stats import chi2_contingency_maybezero, remove_nonzero_cols

x = [
    (0, 168),
    (2, 2),
    (4, 3),
    (8, 2),
    (16, 1),
    (32, 1),
    (35, 1),
    (45, 1),
    (69, 1),
    (83, 1),
    (85, 2),
    (86, 1),
    (87, 3),
    (99, 1),
    (107, 2),
    (111, 1),
    (128, 1),
    (147, 1),
    (154, 1),
    (157, 1),
    (160, 3),
    (165, 2),
    (167, 2),
    (169, 5),
    (170, 17),
    (171, 99),
    (172, 10),
    (173, 2),
    (174, 1),
    (176, 1),
    (179, 1),
    (181, 1),
    (184, 1),
    (191, 1),
    (203, 1),
    (213, 1),
    (239, 1),
    (299, 3),
    (309, 1),
    (325, 2),
    (326, 1),
    (333, 1),
    (334, 1),
    (335, 1),
    (337, 1),
    (338, 2),
    (339, 3),
    (340, 8),
    (341, 102),
    (342, 22),
    (343, 4),
    (344, 1),
    (350, 1),
    (357, 1),
    (368, 1),
    (380, 1),
    (392, 1),
    (405, 2),
    (413, 1),
    (421, 1),
    (426, 1),
    (427, 1),
    (442, 1),
    (479, 1),
    (480, 1),
    (488, 1),
    (490, 1),
    (510, 3),
    (511, 1),
    (512, 121),
    (516, 1),
    (528, 1),
    (544, 2),
    (560, 1),
    (577, 1),
    (587, 1),
    (593, 1),
    (597, 1),
    (619, 2),
    (636, 1),
    (640, 1),
    (650, 1),
    (672, 1),
    (677, 3),
    (678, 1),
    (679, 3),
    (680, 3),
    (681, 6),
    (682, 21),
    (683, 94),
    (684, 12),
    (685, 6),
    (686, 1),
    (687, 2),
    (688, 2),
    (691, 1),
    (693, 1),
    (695, 1),
    (699, 1),
    (700, 2),
    (725, 2),
    (737, 1),
    (741, 1),
    (745, 1),
    (747, 1),
    (768, 8),
    (769, 1),
    (770, 1),
    (811, 1),
    (832, 1),
    (839, 1),
    (847, 2),
    (849, 1),
    (851, 6),
    (852, 4),
    (853, 94),
    (854, 23),
    (855, 7),
    (856, 4),
    (857, 2),
    (859, 1),
    (861, 1),
    (862, 1),
    (871, 1),
    (885, 1),
    (896, 1),
    (901, 1),
    (938, 1),
    (939, 1),
    (944, 1),
    (949, 1),
    (980, 1),
    (981, 1),
    (982, 1),
    (992, 3),
    (1003, 1),
    (1008, 2),
    (1010, 1),
    (1016, 2),
    (1020, 1),
    (1021, 1),
]


y = [
    (0, 16576),
    (8, 1),
    (32, 1),
    (35, 1),
    (41, 1),
    (51, 1),
    (53, 1),
    (57, 1),
    (60, 1),
    (61, 1),
    (64, 1),
    (73, 1),
    (74, 1),
    (75, 1),
    (76, 1),
    (87, 1),
    (91, 1),
    (92, 1),
    (94, 2),
    (98, 1),
    (101, 1),
    (102, 2),
    (104, 1),
    (105, 1),
    (106, 1),
    (107, 2),
    (108, 1),
    (110, 1),
    (111, 1),
    (116, 1),
    (117, 1),
    (118, 1),
    (121, 1),
    (126, 1),
    (127, 3),
    (129, 1),
    (130, 1),
    (133, 1),
    (134, 2),
    (135, 2),
    (136, 1),
    (137, 2),
    (140, 1),
    (141, 3),
    (143, 2),
    (144, 2),
    (145, 1),
    (146, 4),
    (148, 2),
    (149, 2),
    (150, 4),
    (151, 2),
    (152, 4),
    (153, 4),
    (154, 4),
    (155, 6),
    (156, 6),
    (157, 8),
    (158, 9),
    (159, 13),
    (160, 15),
    (161, 17),
    (162, 16),
    (163, 26),
    (164, 31),
    (165, 31),
    (166, 59),
    (167, 106),
    (168, 199),
    (169, 445),
    (170, 2763),
    (171, 11383),
    (172, 714),
    (173, 209),
    (174, 124),
    (175, 54),
    (176, 52),
    (177, 30),
    (178, 27),
    (179, 16),
    (180, 12),
    (181, 12),
    (182, 12),
    (183, 9),
    (184, 7),
    (185, 3),
    (186, 8),
    (187, 7),
    (188, 5),
    (189, 6),
    (190, 4),
    (191, 5),
    (192, 7),
    (193, 3),
    (194, 2),
    (195, 2),
    (196, 2),
    (197, 6),
    (198, 4),
    (199, 1),
    (200, 2),
    (201, 2),
    (203, 1),
    (204, 1),
    (205, 1),
    (207, 1),
    (208, 3),
    (209, 1),
    (210, 1),
    (211, 1),
    (212, 1),
    (214, 2),
    (215, 4),
    (217, 1),
    (218, 2),
    (219, 1),
    (220, 1),
    (222, 1),
    (223, 2),
    (225, 2),
    (226, 1),
    (227, 1),
    (228, 1),
    (235, 2),
    (236, 1),
    (237, 1),
    (239, 1),
    (241, 1),
    (242, 1),
    (254, 1),
    (255, 1),
    (256, 2),
    (257, 3),
    (258, 1),
    (261, 1),
    (262, 1),
    (263, 2),
    (265, 1),
    (266, 1),
    (275, 1),
    (277, 2),
    (278, 1),
    (281, 1),
    (282, 2),
    (283, 2),
    (284, 2),
    (287, 2),
    (288, 1),
    (290, 1),
    (295, 1),
    (297, 1),
    (299, 2),
    (300, 1),
    (301, 4),
    (302, 3),
    (303, 1),
    (304, 2),
    (305, 1),
    (306, 1),
    (308, 1),
    (312, 2),
    (313, 1),
    (314, 2),
    (315, 4),
    (316, 2),
    (317, 1),
    (318, 1),
    (319, 3),
    (320, 1),
    (321, 2),
    (322, 2),
    (323, 1),
    (324, 3),
    (325, 1),
    (326, 6),
    (327, 7),
    (328, 5),
    (329, 7),
    (330, 7),
    (331, 8),
    (332, 13),
    (333, 12),
    (334, 24),
    (335, 25),
    (336, 42),
    (337, 58),
    (338, 104),
    (339, 249),
    (340, 691),
    (341, 11383),
    (342, 2832),
    (343, 481),
    (344, 161),
    (345, 96),
    (346, 61),
    (347, 42),
    (348, 25),
    (349, 20),
    (350, 17),
    (351, 16),
    (352, 7),
    (353, 9),
    (354, 10),
    (355, 13),
    (356, 6),
    (357, 2),
    (358, 6),
    (359, 2),
    (360, 5),
    (361, 3),
    (362, 6),
    (363, 2),
    (364, 2),
    (365, 3),
    (366, 2),
    (367, 1),
    (368, 3),
    (369, 3),
    (372, 1),
    (373, 3),
    (374, 2),
    (377, 1),
    (378, 1),
    (379, 2),
    (381, 3),
    (382, 1),
    (383, 2),
    (385, 1),
    (386, 3),
    (387, 1),
    (392, 1),
    (395, 1),
    (396, 1),
    (400, 1),
    (401, 1),
    (406, 1),
    (407, 1),
    (433, 1),
    (439, 1),
    (440, 1),
    (443, 1),
    (449, 1),
    (465, 1),
    (471, 1),
    (474, 1),
    (486, 1),
    (488, 1),
    (507, 1),
    (512, 16818),
    (522, 1),
    (538, 1),
    (547, 1),
    (549, 2),
    (551, 1),
    (562, 1),
    (568, 1),
    (579, 1),
    (598, 1),
    (600, 1),
    (610, 2),
    (611, 1),
    (614, 1),
    (616, 1),
    (632, 1),
    (634, 1),
    (635, 1),
    (636, 2),
    (637, 2),
    (638, 1),
    (639, 1),
    (642, 1),
    (644, 3),
    (645, 1),
    (646, 2),
    (647, 2),
    (648, 1),
    (650, 1),
    (651, 2),
    (652, 2),
    (653, 2),
    (654, 2),
    (657, 3),
    (658, 2),
    (659, 2),
    (661, 2),
    (662, 1),
    (663, 4),
    (664, 2),
    (665, 4),
    (666, 8),
    (667, 6),
    (668, 2),
    (669, 3),
    (670, 7),
    (671, 10),
    (672, 10),
    (673, 10),
    (674, 19),
    (675, 20),
    (676, 29),
    (677, 37),
    (678, 49),
    (679, 82),
    (680, 201),
    (681, 428),
    (682, 2844),
    (683, 11566),
    (684, 708),
    (685, 228),
    (686, 98),
    (687, 58),
    (688, 56),
    (689, 30),
    (690, 23),
    (691, 9),
    (692, 12),
    (693, 11),
    (694, 6),
    (695, 8),
    (696, 5),
    (697, 9),
    (698, 6),
    (699, 4),
    (700, 7),
    (701, 1),
    (702, 2),
    (703, 4),
    (704, 3),
    (705, 1),
    (706, 3),
    (708, 5),
    (709, 1),
    (710, 3),
    (711, 3),
    (712, 2),
    (713, 1),
    (714, 1),
    (715, 1),
    (716, 3),
    (717, 3),
    (718, 3),
    (719, 1),
    (721, 2),
    (722, 1),
    (723, 2),
    (724, 1),
    (725, 1),
    (728, 2),
    (729, 1),
    (733, 1),
    (734, 2),
    (736, 1),
    (740, 2),
    (744, 1),
    (745, 1),
    (748, 1),
    (749, 1),
    (755, 1),
    (760, 1),
    (763, 1),
    (764, 1),
    (766, 1),
    (767, 1),
    (769, 2),
    (770, 2),
    (773, 1),
    (774, 1),
    (778, 1),
    (787, 1),
    (790, 1),
    (793, 1),
    (794, 3),
    (796, 1),
    (797, 1),
    (799, 2),
    (808, 2),
    (810, 1),
    (811, 1),
    (812, 1),
    (817, 2),
    (818, 3),
    (820, 1),
    (821, 1),
    (822, 2),
    (823, 1),
    (824, 2),
    (825, 2),
    (826, 2),
    (827, 2),
    (828, 6),
    (829, 4),
    (830, 1),
    (831, 3),
    (832, 7),
    (833, 3),
    (834, 3),
    (835, 8),
    (836, 6),
    (837, 1),
    (838, 1),
    (839, 6),
    (840, 7),
    (841, 6),
    (842, 15),
    (843, 15),
    (844, 15),
    (845, 13),
    (846, 22),
    (847, 36),
    (848, 38),
    (849, 70),
    (850, 99),
    (851, 224),
    (852, 692),
    (853, 11501),
    (854, 2788),
    (855, 465),
    (856, 183),
    (857, 88),
    (858, 56),
    (859, 40),
    (860, 35),
    (861, 15),
    (862, 14),
    (863, 17),
    (864, 8),
    (865, 9),
    (866, 9),
    (867, 9),
    (868, 12),
    (869, 6),
    (870, 3),
    (871, 4),
    (872, 5),
    (873, 5),
    (874, 2),
    (875, 3),
    (876, 2),
    (878, 2),
    (880, 3),
    (881, 1),
    (883, 1),
    (884, 2),
    (885, 1),
    (886, 1),
    (887, 3),
    (888, 2),
    (893, 1),
    (894, 1),
    (896, 2),
    (897, 1),
    (902, 1),
    (903, 1),
    (906, 1),
    (909, 1),
    (911, 1),
    (913, 1),
    (914, 1),
    (915, 1),
    (916, 1),
    (923, 2),
    (925, 1),
    (926, 2),
    (928, 1),
    (934, 2),
    (936, 1),
    (941, 1),
    (949, 1),
    (955, 1),
    (960, 1),
    (962, 2),
    (966, 1),
    (969, 1),
    (984, 1),
    (994, 1),
    (995, 1),
    (997, 1),
    (999, 1),
    (1008, 1),
    (1013, 2),
    (1016, 1),
]


def sample_by_y():
    ans = random.choices(list(range(1024)), weights=process_ipt(y).tolist(), k=1000)
    ansd = {}
    for x in ans:
        ansd[x] = ansd.get(x, 0) + 1
    return sorted(ansd.items())


def process_ipt(arg: list[tuple[int, int]]):
    v = np.zeros(1024)
    for x, y in arg:
        v[x] = y
    return v


def compare():
    arr = np.array([process_ipt(x), process_ipt(y)])
    print(arr)

    chi2_stat, p_value, dof, expected = chi2_contingency_maybezero(
        np.array([process_ipt(x), process_ipt(y)]),
        lambda_="log-likelihood",
    )
    print(chi2_stat, p_value, dof, expected)
